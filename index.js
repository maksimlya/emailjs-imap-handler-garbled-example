const { parser }  = require('emailjs-imap-handler');


const testVal = new Uint8Array(Object.values(JSON.parse(`{\"0\":42,\"1\":32,\"2\":49,\"3\":55,\"4\":32,\"5\":70,\"6\":69,\"7\":84,\"8\":67,\"9\":72,\"10\":32,\"11\":40,\"12\":85,\"13\":73,\"14\":68,\"15\":32,\"16\":50,\"17\":55,\"18\":32,\"19\":66,\"20\":79,\"21\":68,\"22\":89,\"23\":91,\"24\":72,\"25\":69,\"26\":65,\"27\":68,\"28\":69,\"29\":82,\"30\":46,\"31\":70,\"32\":73,\"33\":69,\"34\":76,\"35\":68,\"36\":83,\"37\":32,\"38\":40,\"39\":70,\"40\":82,\"41\":79,\"42\":77,\"43\":32,\"44\":84,\"45\":79,\"46\":32,\"47\":67,\"48\":67,\"49\":32,\"50\":66,\"51\":67,\"52\":67,\"53\":32,\"54\":83,\"55\":85,\"56\":66,\"57\":74,\"58\":69,\"59\":67,\"60\":84,\"61\":32,\"62\":82,\"63\":69,\"64\":80,\"65\":76,\"66\":89,\"67\":45,\"68\":84,\"69\":79,\"70\":32,\"71\":77,\"72\":69,\"73\":83,\"74\":83,\"75\":65,\"76\":71,\"77\":69,\"78\":45,\"79\":73,\"80\":68,\"81\":32,\"82\":82,\"83\":69,\"84\":70,\"85\":69,\"86\":82,\"87\":69,\"88\":78,\"89\":67,\"90\":69,\"91\":83,\"92\":32,\"93\":73,\"94\":78,\"95\":45,\"96\":82,\"97\":69,\"98\":80,\"99\":76,\"100\":89,\"101\":45,\"102\":84,\"103\":79,\"104\":32,\"105\":88,\"106\":45,\"107\":87,\"108\":69,\"109\":76,\"110\":67,\"111\":79,\"112\":77,\"113\":69,\"114\":32,\"115\":88,\"116\":45,\"117\":87,\"118\":69,\"119\":76,\"120\":67,\"121\":79,\"122\":77,\"123\":69,\"124\":45,\"125\":69,\"126\":77,\"127\":65,\"128\":73,\"129\":76,\"130\":32,\"131\":88,\"132\":45,\"133\":83,\"134\":83,\"135\":72,\"136\":73,\"137\":68,\"138\":69,\"139\":32,\"140\":88,\"141\":45,\"142\":83,\"143\":83,\"144\":83,\"145\":73,\"146\":78,\"147\":71,\"148\":76,\"149\":69,\"150\":72,\"151\":73,\"152\":68,\"153\":69,\"154\":32,\"155\":68,\"156\":73,\"157\":83,\"158\":80,\"159\":79,\"160\":83,\"161\":73,\"162\":84,\"163\":73,\"164\":79,\"165\":78,\"166\":45,\"167\":78,\"168\":79,\"169\":84,\"170\":73,\"171\":70,\"172\":73,\"173\":67,\"174\":65,\"175\":84,\"176\":73,\"177\":79,\"178\":78,\"179\":45,\"180\":84,\"181\":79,\"182\":32,\"183\":88,\"184\":45,\"185\":67,\"186\":79,\"187\":78,\"188\":70,\"189\":73,\"190\":82,\"191\":77,\"192\":45,\"193\":82,\"194\":69,\"195\":65,\"196\":68,\"197\":73,\"198\":78,\"199\":71,\"200\":45,\"201\":84,\"202\":79,\"203\":32,\"204\":82,\"205\":69,\"206\":84,\"207\":85,\"208\":82,\"209\":78,\"210\":45,\"211\":82,\"212\":69,\"213\":67,\"214\":69,\"215\":73,\"216\":80,\"217\":84,\"218\":45,\"219\":84,\"220\":79,\"221\":32,\"222\":88,\"223\":45,\"224\":80,\"225\":82,\"226\":73,\"227\":79,\"228\":82,\"229\":73,\"230\":84,\"231\":89,\"232\":32,\"233\":73,\"234\":77,\"235\":80,\"236\":79,\"237\":82,\"238\":84,\"239\":65,\"240\":78,\"241\":67,\"242\":69,\"243\":41,\"244\":93,\"245\":32,\"246\":123,\"247\":56,\"248\":49,\"249\":125,\"250\":13,\"251\":10,\"252\":70,\"253\":114,\"254\":111,\"255\":109,\"256\":58,\"257\":32,\"258\":115,\"259\":101,\"260\":110,\"261\":100,\"262\":101,\"263\":114,\"264\":64,\"265\":101,\"266\":120,\"267\":97,\"268\":109,\"269\":112,\"270\":108,\"271\":101,\"272\":46,\"273\":99,\"274\":111,\"275\":109,\"276\":10,\"277\":84,\"278\":111,\"279\":58,\"280\":32,\"281\":114,\"282\":101,\"283\":99,\"284\":105,\"285\":112,\"286\":105,\"287\":101,\"288\":110,\"289\":116,\"290\":64,\"291\":101,\"292\":120,\"293\":97,\"294\":109,\"295\":112,\"296\":108,\"297\":101,\"298\":46,\"299\":99,\"300\":111,\"301\":109,\"302\":10,\"303\":83,\"304\":117,\"305\":98,\"306\":106,\"307\":101,\"308\":99,\"309\":116,\"310\":58,\"311\":32,\"312\":227,\"313\":131,\"314\":134,\"315\":227,\"316\":130,\"317\":185,\"318\":227,\"319\":131,\"320\":136,\"321\":227,\"322\":131,\"323\":161,\"324\":227,\"325\":131,\"326\":188,\"327\":227,\"328\":131,\"329\":171,\"330\":10,\"331\":13,\"332\":10,\"333\":41}`)));
/**
 * This is response I got from IMAP server. Running new TextDecoder().decode(testVal) would result in correct string result:
 * 
 * * 17 FETCH (UID 27 BODY[HEADER.FIELDS (FROM TO CC BCC SUBJECT REPLY-TO MESSAGE-ID REFERENCES IN-REPLY-TO X-WELCOME X-WELCOME-EMAIL X-SSHIDE X-SSSINGLEHIDE DISPOSITION-NOTIFICATION-TO X-CONFIRM-READING-TO RETURN-RECEIPT-TO X-PRIORITY IMPORTANCE)] {81}\r\nFrom: sender@example.com\nTo: recipient@example.com\nSubject: テストメール\n\r\n)
 * 
 * 
 * However, sending it to the 'parser' function results in garbled text where japanese should be:
 * 
 * From: sender@example.com\nTo: recipient@example.com\nSubject: ãã¹ãã¡ã¼ã«\n\r\n
 */



function test() {
    const res = parser(testVal);
    console.log(res);
}

test();